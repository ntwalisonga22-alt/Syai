<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SY AI | Pro Assistant</title>
    <style>
        :root { --primary: #00ff88; --bg: #0a0a0a; --side: #111; --chat: #050505; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar Styles */
        #sidebar { width: 260px; background: var(--side); border-right: 1px solid #222; display: flex; flex-direction: column; padding: 15px; }
        .new-chat-btn { border: 1px solid #444; padding: 12px; border-radius: 8px; text-align: center; cursor: pointer; margin-bottom: 20px; transition: 0.3s; font-weight: bold; }
        .new-chat-btn:hover { background: #222; border-color: var(--primary); }
        .history-item { padding: 10px; font-size: 13px; color: #aaa; cursor: pointer; border-radius: 5px; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .history-item:hover { background: #1a1a1a; color: var(--primary); }

        /* Main Area */
        #main-view { flex: 1; display: flex; flex-direction: column; background: var(--chat); }
        header { padding: 15px 25px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; background: var(--side); }
        .logo-box { display: flex; align-items: center; gap: 10px; color: var(--primary); font-weight: 900; }
        
        #chat-window { flex: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; gap: 20px; }
        .msg { max-width: 80%; padding: 15px; border-radius: 12px; font-size: 15px; line-height: 1.6; animation: fadeIn 0.3s ease; }
        .user { background: #222; align-self: flex-end; border: 1px solid #333; }
        .ai { background: #fff; color: #000; align-self: flex-start; font-weight: 500; white-space: pre-wrap; }

        /* Input & Controls */
        .input-area { padding: 20px; border-top: 1px solid #222; display: flex; gap: 12px; background: var(--side); }
        input { flex: 1; background: #000; border: 1px solid #333; color: #fff; padding: 15px; border-radius: 10px; outline: none; }
        button { background: var(--primary); color: #000; border: none; padding: 0 25px; border-radius: 10px; font-weight: 800; cursor: pointer; }
        
        /* Modal */
        #settings-modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); }
        .modal-content { background: #1a1a1a; margin: 10% auto; padding: 30px; border: 1px solid var(--primary); width: 320px; border-radius: 15px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="new-chat-btn" onclick="startNewChat()">+ New Chat</div>
    <div style="font-size: 11px; color: #555; margin-bottom: 10px; letter-spacing: 1px;">HISTORY</div>
    <div id="history-list"></div>
</div>

<div id="main-view">
    <header>
        <div class="logo-box">
            <svg width="30" height="30" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" stroke="currentColor" stroke-width="8" fill="none"/></svg>
            <span>SY AI PRO</span>
        </div>
        <div onclick="toggleSettings()" style="cursor:pointer">‚öôÔ∏è</div>
    </header>

    <div id="chat-window"></div>

    <div class="input-area">
        <button onclick="startMic()" id="mic-btn" style="background:transparent; color:var(--primary); border:1px solid #333;">üé§</button>
        <input type="text" id="user-input" placeholder="Ask SY AI anything (Search, Code, Math)..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">SEND</button>
    </div>
</div>

<div id="settings-modal" onclick="toggleSettings()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h3 style="color:var(--primary)">SY AI SETTINGS</h3>
        <p>Model: <select id="model-select" onchange="saveSettings()"><option value="gemini-2.5-flash">Flash 2.5</option><option value="gemini-2.5-pro">Pro 2.5</option></select></p>
        <p>Voice: <input type="checkbox" id="voice-toggle" onchange="saveSettings()"></p>
        <button onclick="checkHealth()" style="width:100%; padding:10px;">Check System Health</button>
        <div id="health-status" style="font-size:10px; margin-top:10px; text-align:center;"></div>
    </div>
</div>

<script>
    let currentHistory = [];
    let sessions = JSON.parse(localStorage.getItem('syai_sessions') || '[]');
    let voiceOn = localStorage.getItem('sy_voice') === 'true';

    // Initialize UI
    renderHistory();
    document.getElementById('voice-toggle').checked = voiceOn;

    function toggleSettings() { const m = document.getElementById('settings-modal'); m.style.display = m.style.display === 'block' ? 'none' : 'block'; }
    function saveSettings() {
        voiceOn = document.getElementById('voice-toggle').checked;
        localStorage.setItem('sy_voice', voiceOn);
        localStorage.setItem('sy_model', document.getElementById('model-select').value);
    }

    function renderHistory() {
        const list = document.getElementById('history-list');
        list.innerHTML = sessions.map((s, i) => `<div class="history-item" onclick="loadSession(${i})">${s.title}</div>`).join('');
    }

    function startNewChat() {
        if(currentHistory.length > 0) {
            sessions.unshift({ title: currentHistory[0].parts[0].text.substring(0,25) + '...', data: currentHistory });
            localStorage.setItem('syai_sessions', JSON.stringify(sessions.slice(0, 15)));
        }
        currentHistory = [];
        document.getElementById('chat-window').innerHTML = '';
        renderHistory();
    }

    async function sendMessage() {
        const input = document.getElementById('user-input');
        const text = input.value.trim();
        if(!text) return;

        const win = document.getElementById('chat-window');
        win.innerHTML += `<div class="msg user">${text}</div>`;
        input.value = '';

        try {
            const res = await fetch('/api/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    message: text, 
                    history: currentHistory, 
                    model: localStorage.getItem('sy_model') || 'gemini-2.5-flash' 
                })
            });
            const data = await res.json();
            
            win.innerHTML += `<div class="msg ai">${data.reply}</div>`;
            win.scrollTop = win.scrollHeight;

            // Maintain Memory
            currentHistory.push({ role: "user", parts: [{ text: text }] });
            currentHistory.push({ role: "model", parts: [{ text: data.reply }] });

            if(voiceOn) {
                window.speechSynthesis.cancel();
                window.speechSynthesis.speak(new SpeechSynthesisUtterance(data.reply));
            }
        } catch (e) { win.innerHTML += `<div class="msg ai">SY AI: Error connecting to server.</div>`; }
    }

    // Diagnostics
    async function checkHealth() {
        const status = document.getElementById('health-status');
        status.innerText = "Scanning SY AI Core...";
        const res = await fetch('/api/chat', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ checkStatus: true })});
        const data = await res.json();
        status.innerText = data.status === "Online" ? "‚úÖ CORE CONNECTED" : "‚ùå CORE OFFLINE";
    }

    const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    function startMic() { rec.start(); document.getElementById('mic-btn').innerText = "‚óè"; }
    rec.onresult = (e) => { document.getElementById('user-input').value = e.results[0][0].transcript; sendMessage(); document.getElementById('mic-btn').innerText = "üé§"; };
</script>
</body>
</html>

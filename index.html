<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SY AI PRO</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        /* THEMES */
        [data-theme="dark"] { --primary: #00ff88; --bg: #0a0a0a; --side: #111; --text: #fff; --msg-user: #222; }
        [data-theme="light"] { --primary: #0077ff; --bg: #f5f5f5; --side: #e0e0e0; --text: #000; --msg-user: #ddd; }
        [data-theme="cyber"] { --primary: #ff00ff; --bg: #0b001a; --side: #1a0033; --text: #00ffff; --msg-user: #2a0066; }

        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; transition: 0.3s; }
        
        /* SIDEBAR */
        #sidebar { width: 280px; background: var(--side); border-right: 1px solid #333; display: flex; flex-direction: column; padding: 20px; }
        .logo-container { display: flex; align-items: center; gap: 10px; margin-bottom: 30px; font-weight: 900; font-size: 22px; color: var(--primary); }
        .new-chat-btn { background: var(--primary); color: #000; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 20px; }
        #history-list { flex: 1; overflow-y: auto; font-size: 14px; display: flex; flex-direction: column; gap: 10px; }
        .history-item { padding: 8px; border-radius: 5px; cursor: pointer; border: 1px solid #444; }

        /* MAIN VIEW */
        #main-view { flex: 1; display: flex; flex-direction: column; }
        header { padding: 15px 25px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .controls { display: flex; gap: 15px; align-items: center; }
        select { background: #222; color: #fff; border: 1px solid var(--primary); padding: 5px; border-radius: 5px; cursor: pointer; }

        /* CHAT */
        #chat-window { flex: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; gap: 20px; }
        .msg { max-width: 80%; padding: 15px; border-radius: 12px; position: relative; line-height: 1.5; }
        .user { background: var(--msg-user); align-self: flex-end; }
        .ai { background: #fff; color: #000; align-self: flex-start; border-left: 5px solid var(--primary); }
        
        /* INPUT AREA */
        .input-area { padding: 20px; border-top: 1px solid #333; display: flex; gap: 10px; background: var(--side); }
        input { flex: 1; background: #000; border: 1px solid #444; color: #fff; padding: 15px; border-radius: 10px; outline: none; }
        .icon-btn { background: #333; border: none; padding: 10px; border-radius: 50%; cursor: pointer; font-size: 20px; transition: 0.2s; }
        .mic-active { background: red !important; }

        /* LOGIN MODAL */
        #login-modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); }
        .login-box { background: #1a1a1a; margin: 15% auto; padding: 40px; border: 1px solid var(--primary); width: 300px; border-radius: 20px; text-align: center; }
    </style>
</head>
<body>

<div id="login-modal">
    <div class="login-box">
        <h3 style="color:var(--primary)">SY AI Login</h3>
        <p style="color:#888">Guest limit reached. Log in to continue.</p>
        <div id="g_id_onload" data-client_id="YOUR_GOOGLE_CLIENT_ID" data-callback="handleLogin"></div>
        <div class="g_id_signin" data-type="standard"></div>
        <button onclick="closeLogin()" style="background:transparent; color:#555; border:none; margin-top:15px; text-decoration:underline;">Keep Searching</button>
    </div>
</div>

<div id="sidebar">
    <div class="logo-container">
        <svg width="40" height="40" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="50" cy="50" r="45" stroke="currentColor" stroke-width="5"/>
            <path d="M30 40C30 30 40 25 50 25C60 25 70 30 70 40C70 50 50 55 50 65" stroke="currentColor" stroke-width="8" stroke-linecap="round"/>
            <circle cx="50" cy="80" r="5" fill="currentColor"/>
        </svg>
        SY AI PRO
    </div>
    
    <button class="new-chat-btn" onclick="newChat()">+ New Chat</button>
    
    <div id="history-list">
        <div class="history-item">Previous Search 1...</div>
    </div>

    <div id="user-status" style="margin-top:auto; font-size:12px; border-top:1px solid #333; padding-top:10px;">
        ðŸ‘¤ Mode: <span id="user-label">Guest</span>
    </div>
</div>

<div id="main-view">
    <header>
        <div class="controls">
            <select id="model-select">
                <option value="gemini-2.5-flash">Flash (Fast)</option>
                <option value="gemini-2.5-pro">Pro (Smart)</option>
            </select>
            <select onchange="changeTheme(this.value)">
                <option value="dark">Dark</option>
                <option value="light">Light</option>
                <option value="cyber">Cyber</option>
            </select>
        </div>
        <div style="font-size:18px;">âœ¨</div>
    </header>

    <div id="chat-window">
        <div class="msg ai">Welcome back! I am <b>SY AI</b>. How can I help you today?</div>
    </div>

    <div class="input-area">
        <button id="mic-btn" class="icon-btn" onclick="startVoice()">ðŸŽ¤</button>
        <input type="text" id="user-input" placeholder="Message SY AI..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button class="icon-btn" style="background:var(--primary); color:#000;" onclick="sendMessage()">âž¤</button>
    </div>
</div>

<script>
    let searchCount = parseInt(localStorage.getItem('sy_count') || '0');
    let user = JSON.parse(localStorage.getItem('sy_user') || 'null');
    let currentHistory = [];

    // --- NEW CHAT ---
    function newChat() {
        document.getElementById('chat-window').innerHTML = `<div class="msg ai">New Session Started. How can I help?</div>`;
        currentHistory = [];
    }

    // --- THEME ---
    function changeTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
    }

    // --- LOGIN ---
    function handleLogin(response) {
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        user = { name: payload.name };
        localStorage.setItem('sy_user', JSON.stringify(user));
        document.getElementById('user-label').innerText = user.name;
        closeLogin();
    }
    function closeLogin() { document.getElementById('login-modal').style.display = 'none'; searchCount = 0; }

    // --- VOICE ---
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.onresult = (e) => { document.getElementById('user-input').value = e.results[0][0].transcript; sendMessage(); };
    function startVoice() { recognition.start(); document.getElementById('mic-btn').classList.add('mic-active'); }
    recognition.onend = () => document.getElementById('mic-btn').classList.remove('mic-active');

    // --- CHAT LOGIC ---
    async function sendMessage() {
        const input = document.getElementById('user-input');
        const text = input.value.trim();
        const model = document.getElementById('model-select').value;
        if(!text) return;

        if(!user && searchCount >= 2) { document.getElementById('login-modal').style.display = 'block'; return; }

        const win = document.getElementById('chat-window');
        win.innerHTML += `<div class="msg user">${text}</div>`;
        input.value = '';

        try {
            const res = await fetch('/api/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ message: text, history: currentHistory, user: user, model: model })
            });
            const data = await res.json();
            
            let html = `<div class="msg ai">${data.reply}`;
            if(data.image) html += `<br><img src="${data.image}" style="width:100%; border-radius:8px; margin-top:10px;"><br><button onclick="downloadImg('${data.image}')" style="cursor:pointer; background:var(--primary); border:none; padding:5px; margin-top:5px; border-radius:4px;">Download</button>`;
            html += `</div>`;
            
            win.innerHTML += html;
            win.scrollTop = win.scrollHeight;

            if(!user) { searchCount++; localStorage.setItem('sy_count', searchCount); }
            currentHistory.push({role:"user", parts:[{text:text}]}, {role:"model", parts:[{text:data.reply || "Image"}]});
        } catch (e) { win.innerHTML += `<div class="msg ai">Error connecting to SY AI.</div>`; }
    }

    function downloadImg(base) { const a = document.createElement('a'); a.href = base; a.download = 'SYAI_Image.png'; a.click(); }
</script>
</body>
</html>

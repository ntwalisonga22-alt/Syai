<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SY AI | Pro</title>
    <style>
        :root { --primary: #00ff88; --bg: #050505; --sidebar: #0f0f0f; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; }
        
        /* Sidebar for Saved Chats */
        #sidebar { width: 260px; background: var(--sidebar); border-right: 1px solid #222; display: flex; flex-direction: column; padding: 15px; }
        .new-chat-btn { border: 1px solid #444; padding: 10px; border-radius: 8px; text-align: center; cursor: pointer; margin-bottom: 20px; transition: 0.3s; }
        .new-chat-btn:hover { background: #222; border-color: var(--primary); }
        .history-item { padding: 8px; font-size: 13px; color: #aaa; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Main Chat Area */
        #main-chat { flex: 1; display: flex; flex-direction: column; position: relative; }
        header { padding: 15px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
        #chat-window { flex: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; gap: 20px; }
        
        .msg { max-width: 80%; padding: 15px; border-radius: 12px; line-height: 1.6; }
        .user { background: #1a1a1a; align-self: flex-end; border: 1px solid #333; }
        .ai { background: transparent; align-self: flex-start; border-left: 2px solid var(--primary); padding-left: 20px; }

        .input-box { padding: 20px; background: var(--bg); display: flex; gap: 10px; border-top: 1px solid #222; }
        input { flex: 1; background: #111; border: 1px solid #333; color: #fff; padding: 15px; border-radius: 10px; outline: none; }
        button { background: var(--primary); color: #000; border: none; padding: 0 20px; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="new-chat-btn" onclick="startNewChat()">+ New Chat</div>
    <div style="font-size: 11px; color: #555; margin-bottom: 10px;">RECENT HISTORY</div>
    <div id="chat-history-list"></div>
</div>

<div id="main-chat">
    <header>
        <span style="color:var(--primary); font-weight:900;">SY AI PRO</span>
        <div onclick="toggleSettings()" style="cursor:pointer">⚙️</div>
    </header>

    <div id="chat-window"></div>

    <div class="input-box">
        <input type="text" id="user-input" placeholder="Ask anything (Search web, code, or solve puzzles)..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">SEND</button>
    </div>
</div>

<script>
    let chatHistory = []; // Current session history
    let savedSessions = JSON.parse(localStorage.getItem('syai_sessions') || '[]');

    function renderHistoryList() {
        const list = document.getElementById('chat-history-list');
        list.innerHTML = savedSessions.map((s, i) => `<div class="history-item" onclick="loadSession(${i})">Chat: ${s.preview}</div>`).join('');
    }
    renderHistoryList();

    function startNewChat() {
        if(chatHistory.length > 0) {
            savedSessions.unshift({ preview: chatHistory[0].parts[0].text.substring(0, 20), data: chatHistory });
            localStorage.setItem('syai_sessions', JSON.stringify(savedSessions.slice(0, 10)));
        }
        chatHistory = [];
        document.getElementById('chat-window').innerHTML = '';
        renderHistoryList();
    }

    async function sendMessage() {
        const input = document.getElementById('user-input');
        const text = input.value.trim();
        if(!text) return;

        const win = document.getElementById('chat-window');
        win.innerHTML += `<div class="msg user">${text}</div>`;
        input.value = '';

        try {
            const res = await fetch('/api/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    message: text, 
                    history: chatHistory,
                    model: "gemini-3-flash" 
                })
            });
            const data = await res.json();
            
            win.innerHTML += `<div class="msg ai">${data.reply}</div>`;
            win.scrollTop = win.scrollHeight;

            // Update local memory for "saving"
            chatHistory.push({ role: "user", parts: [{ text: text }] });
            chatHistory.push({ role: "model", parts: [{ text: data.reply }] });

        } catch (e) {
            win.innerHTML += `<div class="msg ai">Connection Error.</div>`;
        }
    }
</script>
</body>
</html>
